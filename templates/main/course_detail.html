{% extends 'base.html' %}
{% load static %}

{% block title %}{{ course.title }} - FinSmart{% endblock %}

{% block content %}
<!-- Course Hero Section -->
<section class="course-hero" style="padding: 100px 0; background-color: var(--bg-secondary);">
    <div class="container">
        <div class="course-hero-content"
            style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: center;">
            <div class="course-hero-left">
                <div class="rating-badge"
                    style="display: inline-flex; align-items: center; gap: 5px; background: rgba(255, 179, 0, 0.1); padding: 5px 10px; border-radius: 20px; color: #F57C00; margin-bottom: 20px;">
                    <span style="font-size: 14px;">‚òÖ</span>
                    <span style="font-weight: 600;">{{ course.rating }} –†–µ–π—Ç–∏–Ω–≥ –∫—É—Ä—Å—É</span>
                </div>
                <h1 class="course-title-large" style="font-size: 42px; font-weight: bold;">{{ course.title }}</h1>

                {% if user.is_staff %}
                <div class="admin-course-actions"
                    style="display: flex; gap: 12px; margin-bottom: 16px; align-items: center;">
                    <span style="font-size: 13px; color: #ffcc00; font-weight: 700; opacity: 0.85;">üëë –†–µ–∂–∏–º
                        –∞–¥–º—ñ–Ω–∞:</span>
                    <a href="{% url 'edit_course' course.id %}" class="btn-admin-edit">‚úèÔ∏è –†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
                    <a href="{% url 'delete_course' course.id %}" class="btn-admin-delete">üóëÔ∏è –í–∏–¥–∞–ª–∏—Ç–∏</a>
                </div>
                {% endif %}
                <p class="course-description" style="font-size: 18px; color: var(--text-muted); margin-bottom: 30px;">
                    {{ course.description }}
                </p>

                <div class="course-meta" style="display: flex; gap: 20px; margin-bottom: 40px;">
                    <div class="meta-item" style="display: flex; align-items: center; gap: 10px;">
                        <div class="icon-box"
                            style="width: 40px; height: 40px; background: #E3F2FD; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#4A8FD5"
                                stroke-width="2">
                                <circle cx="12" cy="12" r="10"></circle>
                                <polyline points="12 6 12 12 16 14"></polyline>
                            </svg>
                        </div>
                        <div>
                            <span style="display: block; font-size: 12px; color: var(--text-muted);">–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å</span>
                            <span style="font-weight: 600;">{{ course.duration|default:"4 —Ç–∏–∂–Ω—ñ" }}</span>
                        </div>
                    </div>
                    <div class="meta-item" style="display: flex; align-items: center; gap: 10px;">
                        <div class="icon-box"
                            style="width: 40px; height: 40px; background: #E8F5E9; border-radius: 50%; display: flex; align-items: center; justify-content: center;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="#43A047"
                                stroke-width="2">
                                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                                <polyline points="22 4 12 14.01 9 11.01"></polyline>
                            </svg>
                        </div>
                        <div>
                            <span style="display: block; font-size: 12px; color: var(--text-muted);">–†—ñ–≤–µ–Ω—å</span>
                            <span style="font-weight: 600;">–ü–æ—á–∞—Ç–∫–æ–≤–∏–π</span>
                        </div>
                    </div>
                </div>

                <!-- ‚îÄ‚îÄ Cart Button ‚îÄ‚îÄ -->
                <div class="course-price-action" style="display: flex; align-items: center; gap: 20px;">
                    <div class="price" style="font-size: 32px; font-weight: 800; color: var(--brand-primary);">
                        {{ course.price }} –≥—Ä–Ω
                    </div>
                    {% if in_cart %}
                    <button class="btn-in-cart" disabled>‚úì –î–æ–¥–∞–Ω–æ</button>
                    {% else %}
                    <button id="btn-cart-{{ course.id }}" class="btn-primary" style="padding: 15px 40px; font-size: 18px; border-radius: 12px;
                               box-shadow: 0 10px 20px rgba(74,143,213,0.2); cursor: pointer;">
                        –í –∫–æ—à–∏–∫
                    </button>
                    {% endif %}
                </div>

                <style>
                    .btn-in-cart {
                        padding: 15px 40px;
                        font-size: 18px;
                        border-radius: 12px;
                        background: #e2f0fb;
                        color: #2c5282;
                        border: 2px solid #4a8fd5;
                        font-weight: 700;
                        cursor: default;
                        opacity: 0.9;
                    }

                    [data-theme="dark"] .btn-in-cart {
                        background: rgba(74, 143, 213, 0.15);
                        color: #90cdf4;
                        border-color: #4a8fd5;
                    }
                </style>

                <script>
                    (function () {
                        const btn = document.getElementById('btn-cart-{{ course.id }}');
                        if (!btn) return; // –≤–∂–µ –≤ –∫–æ—à–∏–∫—É ‚Äî –∫–Ω–æ–ø–∫–∏ –Ω–µ–º–∞—î

                        btn.addEventListener('click', function () {
                            btn.disabled = true;
                            btn.textContent = '–î–æ–¥–∞—î–º–æ...';

                            const csrfToken = document.cookie.split('; ')
                                .find(r => r.startsWith('csrftoken='))
                                ?.split('=')[1] || '';

                            fetch("{% url 'add_to_cart' course.id %}", {
                                method: 'POST',
                                headers: { 'X-CSRFToken': csrfToken },
                                credentials: 'same-origin',
                            })
                                .then(r => r.json())
                                .then(data => {
                                    if (data.success) {
                                        btn.textContent = '‚úì –î–æ–¥–∞–Ω–æ';
                                        btn.className = 'btn-in-cart';
                                        btn.removeAttribute('style');

                                        // –û–Ω–æ–≤–ª—é—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫ –∫–æ—à–∏–∫–∞ –≤ —à–∞–ø—Ü—ñ
                                        const badge = document.getElementById('cartBadge');
                                        if (badge && data.cart_count !== undefined) {
                                            badge.textContent = data.cart_count;
                                            badge.classList.remove('d-none');
                                        }

                                        // –ü–µ—Ä–µ—Ö–æ–¥–∏–º–æ –¥–æ –∫–æ—à–∏–∫–∞ —á–µ—Ä–µ–∑ 600 –º—Å
                                        setTimeout(() => {
                                            window.location.href = "{% url 'cart_detail' %}";
                                        }, 600);
                                    } else {
                                        btn.disabled = false;
                                        btn.textContent = '–í –∫–æ—à–∏–∫';
                                    }
                                })
                                .catch(() => {
                                    btn.disabled = false;
                                    btn.textContent = '–í –∫–æ—à–∏–∫';
                                });
                        });
                    })();
                </script>

            </div><!-- /.course-hero-left -->

            <div class="course-hero-right" style="position: relative;">
                <div class="course-image-wrapper"
                    style="border-radius: 20px; overflow: hidden; box-shadow: 0 20px 40px rgba(0,0,0,0.1);">
                    <img src="{% static 'img/image 10.png' %}" alt="{{ course.title }}"
                        style="width: 100%; height: auto; object-fit: cover;">
                </div>
            </div>
        </div>
    </div>
</section>

<!-- What you'll learn -->
<section class="course-learn" style="padding: 80px 0;">
    <div class="container">
        <h2 class="section-title">–ß–æ–≥–æ –≤–∏ –Ω–∞–≤—á–∏—Ç–µ—Å—è</h2>
        <div class="learn-grid"
            style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 20px; margin-top: 40px;">
            <div class="learn-item"
                style="display: flex; gap: 15px; padding: 20px; background: var(--bg-secondary); border-radius: 12px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4CAF50" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                <span class="learn-text">–ï—Ñ–µ–∫—Ç–∏–≤–Ω–æ –∫–µ—Ä—É–≤–∞—Ç–∏ –æ—Å–æ–±–∏—Å—Ç–∏–º–∏ —Ñ—ñ–Ω–∞–Ω—Å–∞–º–∏ —Ç–∞ –ø–ª–∞–Ω—É–≤–∞—Ç–∏ –±—é–¥–∂–µ—Ç</span>
            </div>
            <div class="learn-item"
                style="display: flex; gap: 15px; padding: 20px; background: var(--bg-secondary); border-radius: 12px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4CAF50" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                <span class="learn-text">–†–æ–∑—É–º—ñ—Ç–∏ –ø—Ä–∏–Ω—Ü–∏–ø–∏ —ñ–Ω–≤–µ—Å—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –ø–∞—Å–∏–≤–Ω–æ–≥–æ –¥–æ—Ö–æ–¥—É</span>
            </div>
            <div class="learn-item"
                style="display: flex; gap: 15px; padding: 20px; background: var(--bg-secondary); border-radius: 12px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4CAF50" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                <span class="learn-text">–£–Ω–∏–∫–∞—Ç–∏ —Ç–∏–ø–æ–≤–∏—Ö —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö –ø–∞—Å—Ç–æ–∫ —Ç–∞ –±–æ—Ä–≥—ñ–≤</span>
            </div>
            <div class="learn-item"
                style="display: flex; gap: 15px; padding: 20px; background: var(--bg-secondary); border-radius: 12px;">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#4CAF50" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
                <span class="learn-text">–°—Ç–≤–æ—Ä–∏—Ç–∏ —á—ñ—Ç–∫–∏–π –ø–ª–∞–Ω –¥–æ—Å—è–≥–Ω–µ–Ω–Ω—è —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö —Ü—ñ–ª–µ–π</span>
            </div>
        </div>
    </div>
</section>

<!-- Curriculum -->
<section class="course-curriculum" style="padding: 80px 0; background-color: var(--bg-secondary);">
    <div class="container">
        <h2 class="section-title">–ü—Ä–æ–≥—Ä–∞–º–∞ –∫—É—Ä—Å—É</h2>
        <div class="modules-list" style="max-width: 800px; margin: 40px auto 0;">
            <div class="module-item"
                style="background: var(--bg-primary); padding: 25px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                <h3 style="font-size: 18px; margin-bottom: 10px; color: var(--brand-primary);">–ú–æ–¥—É–ª—å 1: –û—Å–Ω–æ–≤–∏</h3>
                <p style="color: var(--text-muted);">–í–≤–µ–¥–µ–Ω–Ω—è —É —Ç–µ–º—É, –æ—Å–Ω–æ–≤–Ω—ñ —Ç–µ—Ä–º—ñ–Ω–∏ —Ç–∞ –ø–æ–Ω—è—Ç—Ç—è. –ê–Ω–∞–ª—ñ–∑ –ø–æ—Ç–æ—á–Ω–æ—ó
                    —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–æ—ó —Å–∏—Ç—É–∞—Ü—ñ—ó.</p>
            </div>
            <div class="module-item"
                style="background: var(--bg-primary); padding: 25px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                <h3 style="font-size: 18px; margin-bottom: 10px; color: var(--brand-primary);">–ú–æ–¥—É–ª—å 2: –Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏
                </h3>
                <p style="color: var(--text-muted);">–û–≥–ª—è–¥ —Ñ—ñ–Ω–∞–Ω—Å–æ–≤–∏—Ö —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤. –ë–∞–Ω–∫—ñ–≤—Å—å–∫—ñ –ø—Ä–æ–¥—É–∫—Ç–∏, –¥–µ–ø–æ–∑–∏—Ç–∏,
                    –∫–∞—Ä—Ç–∫–∏.</p>
            </div>
            <div class="module-item"
                style="background: var(--bg-primary); padding: 25px; margin-bottom: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.05);">
                <h3 style="font-size: 18px; margin-bottom: 10px; color: var(--brand-primary);">–ú–æ–¥—É–ª—å 3: –°—Ç—Ä–∞—Ç–µ–≥—ñ—è</h3>
                <p style="color: var(--text-muted);">–†–æ–∑—Ä–æ–±–∫–∞ –¥–æ–≤–≥–æ—Å—Ç—Ä–æ–∫–æ–≤–æ—ó —Å—Ç—Ä–∞—Ç–µ–≥—ñ—ó. –ü–µ–Ω—Å—ñ–π–Ω–µ –ø–ª–∞–Ω—É–≤–∞–Ω–Ω—è —Ç–∞
                    —Å—Ç—Ä–∞—Ö—É–≤–∞–Ω–Ω—è.</p>
            </div>
        </div>
    </div>
</section>

<!-- Target Audience -->
<section class="course-audience" style="padding: 80px 0;">
    <div class="container">
        <h2 class="section-title">–î–ª—è –∫–æ–≥–æ —Ü–µ–π –∫—É—Ä—Å</h2>
        <div class="audience-grid"
            style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 30px; margin-top: 40px;">
            <div class="audience-card"
                style="text-align: center; padding: 30px; background: var(--bg-secondary); border-radius: 16px;">
                <div class="icon" style="font-size: 40px; margin-bottom: 20px;">üéì</div>
                <h3 style="margin-bottom: 10px;">–î–ª—è –ø–æ—á–∞—Ç–∫—ñ–≤—Ü—ñ–≤</h3>
                <p style="color: var(--text-muted);">–•—Ç–æ —Ç—ñ–ª—å–∫–∏ –ø–æ—á–∏–Ω–∞—î —Ü—ñ–∫–∞–≤–∏—Ç–∏—Å—è —Ñ—ñ–Ω–∞–Ω—Å–∞–º–∏</p>
            </div>
            <div class="audience-card"
                style="text-align: center; padding: 30px; background: var(--bg-secondary); border-radius: 16px;">
                <div class="icon" style="font-size: 40px; margin-bottom: 20px;">üíº</div>
                <h3 style="margin-bottom: 10px;">–î–ª—è –ø—Ä–∞—Ü—ñ–≤–Ω–∏–∫—ñ–≤</h3>
                <p style="color: var(--text-muted);">–•—Ç–æ —Ö–æ—á–µ –µ—Ñ–µ–∫—Ç–∏–≤–Ω—ñ—à–µ –∫–µ—Ä—É–≤–∞—Ç–∏ –∑–∞—Ä–ø–ª–∞—Ç–æ—é</p>
            </div>
            <div class="audience-card"
                style="text-align: center; padding: 30px; background: var(--bg-secondary); border-radius: 16px;">
                <div class="icon" style="font-size: 40px; margin-bottom: 20px;">üè†</div>
                <h3 style="margin-bottom: 10px;">–î–ª—è —Å—ñ–º–µ–π</h3>
                <p style="color: var(--text-muted);">–•—Ç–æ –ø–ª–∞–Ω—É—î —Å–ø—ñ–ª—å–Ω–∏–π –±—é–¥–∂–µ—Ç —Ç–∞ –≤–µ–ª–∏–∫—ñ –ø–æ–∫—É–ø–∫–∏</p>
            </div>
        </div>
    </div>
</section>

{% endblock %}