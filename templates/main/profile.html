{% extends 'base.html' %}
{% load static %}

{% block title %}–ú—ñ–π –ø—Ä–æ—Ñ—ñ–ª—å - FinSmart{% endblock %}

{% block content %}
<div style="background-color: var(--bg-primary); min-height: 80vh; padding: 60px 0;">
    <div class="container">
        <!-- Hero Profile Section -->
        <div class="profile-header" style="text-align: center; margin-bottom: 50px;">
            <div
                style="width: 100px; height: 100px; background: var(--brand-secondary); border-radius: 50%; overflow: hidden; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; box-shadow: 0 10px 25px rgba(74, 143, 213, 0.3);">
                {% if user.profile.image and user.profile.image.url != '/media/default.jpg' %}
                <img src="{{ user.profile.image.url }}"
                    style="width:100%; height:100%; border-radius:50%; object-fit:cover;">
                {% else %}
                <div class="letter-avatar">{{ user.username|first|upper }}</div>
                {% endif %}
            </div>
            <h1 style="font-size: 28px; font-weight: 800; color: var(--text-primary); margin-bottom: 20px;">–ú—ñ–π
                –æ—Å–æ–±–∏—Å—Ç–∏–π –∫–∞–±—ñ–Ω–µ—Ç</h1>
        </div>

        <div class="profile-grid" style="display: grid; grid-template-columns: 2fr 1fr; gap: 30px;">

            <!-- Left Column -->
            <div class="profile-main-content" style="display: flex; flex-direction: column; gap: 30px;">

                <!-- Investment Chart Section -->
                <div class="card"
                    style="background: var(--bg-card); border-radius: 20px; padding: 30px; box-shadow: var(--shadow-md); border: 1px solid var(--border-color);">
                    <h2
                        style="font-size: 22px; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            style="color: var(--brand-primary);">
                            <line x1="12" y1="20" x2="12" y2="10"></line>
                            <line x1="18" y1="20" x2="18" y2="4"></line>
                            <line x1="6" y1="20" x2="6" y2="16"></line>
                        </svg>
                        –ú—ñ–π –ø—Ä–æ–≥—Ä–µ—Å
                    </h2>
                    <div id="investment-chart-container"
                        style="height: 300px; background: rgba(74, 143, 213, 0.05); border-radius: 12px; display: flex; align-items: center; justify-content: center; border: 2px dashed rgba(74, 143, 213, 0.2);">
                        <div style="text-align: center; color: var(--text-muted);">
                            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"
                                style="margin-bottom: 15px; opacity: 0.5;">
                                <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"></polyline>
                            </svg>
                            <p style="font-size: 16px; font-weight: 500;">–¢—É—Ç –±—É–¥–µ –≤–∞—à –≥—Ä–∞—Ñ—ñ–∫ —Å–∫–ª–∞–¥–Ω–∏—Ö –≤—ñ–¥—Å–æ—Ç–∫—ñ–≤</p>
                        </div>
                    </div>
                </div>

                <!-- My Courses Section -->
                <div class="card"
                    style="background: var(--bg-card); border-radius: 20px; padding: 30px; box-shadow: var(--shadow-md); border: 1px solid var(--border-color);">
                    <h2
                        style="font-size: 22px; font-weight: 700; color: var(--text-primary); margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                            stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                            style="color: var(--brand-primary);">
                            <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path>
                            <path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path>
                        </svg>
                        –ú–æ—ó –∫—É—Ä—Å–∏
                    </h2>

                    {% if user_courses %}
                    <div class="user-courses-list" style="display: grid; gap: 20px;">
                        {% for item in user_courses %}
                        <div class="course-item"
                            style="display: flex; gap: 20px; padding: 20px; background: var(--bg-primary); border-radius: 12px; align-items: center;">
                            <div class="course-icon"
                                style="width: 60px; height: 60px; background: white; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 24px;">
                                üìö
                            </div>
                            <div style="flex: 1;">
                                <h3
                                    style="font-size: 18px; font-weight: 600; margin-bottom: 5px; color: var(--text-primary);">
                                    {{ item.course.title }}</h3>
                                <div
                                    style="width: 100%; height: 6px; background: #e2e8f0; border-radius: 3px; overflow: hidden; margin-top: 10px;">
                                    <div style="width: 0%; height: 100%; background: var(--accent-orange);"></div>
                                </div>
                                <div
                                    style="display: flex; justify-content: space-between; font-size: 12px; color: var(--text-muted); margin-top: 5px;">
                                    <span>–ü—Ä–æ–≥—Ä–µ—Å: 0%</span>
                                    <span>–ù–µ —Ä–æ–∑–ø–æ—á–∞—Ç–æ</span>
                                </div>
                            </div>
                            <a href="{% url 'course_detail' item.course.id %}" class="btn-secondary"
                                style="font-size: 14px; padding: 8px 16px;">–ü—Ä–æ–¥–æ–≤–∂–∏—Ç–∏</a>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="empty-state" style="text-align: center; padding: 40px 0;">
                        <p style="font-size: 16px; color: var(--text-secondary); margin-bottom: 20px;">–í–∏ —â–µ –Ω–µ
                            —Ä–æ–∑–ø–æ—á–∞–ª–∏ –∂–æ–¥–Ω–æ–≥–æ –∫—É—Ä—Å—É</p>
                        <a href="{% url 'courses' %}" class="btn-primary"
                            style="padding: 12px 24px; font-size: 16px;">–ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ –∫–∞—Ç–∞–ª–æ–≥</a>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Right Column (Sidebar) -->
            <div class="profile-sidebar">
                <div class="card"
                    style="background: var(--bg-card); border-radius: 20px; padding: 30px; box-shadow: var(--shadow-md); border: 1px solid var(--border-color); position: sticky; top: 100px;">
                    <h3 style="font-size: 18px; font-weight: 600; color: var(--text-primary); margin-bottom: 20px;">
                        –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è</h3>

                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <a href="{% url 'edit_profile' %}" class="action-btn"
                            style="width: 100%; text-align: left; padding: 15px; background: transparent; border: 1px solid var(--border-color); border-radius: 10px; color: var(--text-primary); font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 10px; text-decoration: none;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                            </svg>
                            –†–µ–¥–∞–≥—É–≤–∞—Ç–∏ –ø—Ä–æ—Ñ—ñ–ª—å
                        </a>

                        <button class="action-btn"
                            style="width: 100%; text-align: left; padding: 15px; background: transparent; border: 1px solid var(--border-color); border-radius: 10px; color: var(--text-primary); font-weight: 500; cursor: pointer; transition: all 0.2s; display: flex; align-items: center; gap: 10px;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                            </svg>
                            –ë–µ–∑–ø–µ–∫–∞
                        </button>

                        <hr style="border: 0; border-top: 1px solid var(--border-color); margin: 5px 0;">

                        <a href="{% url 'logout' %}" class="logout-btn"
                            style="width: 100%; text-align: center; padding: 15px; background: #fee2e2; border: 1px solid #fecaca; border-radius: 10px; color: #dc2626; font-weight: 600; cursor: pointer; transition: all 0.2s; text-decoration: none; display: flex; align-items: center; justify-content: center; gap: 10px;">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                                stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                                <polyline points="16 17 21 12 16 7"></polyline>
                                <line x1="21" y1="12" x2="9" y2="12"></line>
                            </svg>
                            –í–∏–π—Ç–∏ –∑ –∞–∫–∞—É–Ω—Ç–∞
                        </a>
                    </div>
                </div>
            </div>

        </div>

        {% if user.is_staff and contact_messages is not None %}
        <!-- Admin: Contact Messages Inbox -->
        <div class="card" style="background: var(--bg-card); border-radius: 20px; padding: 36px;
                    box-shadow: var(--shadow-md); border: 1px solid rgba(255,204,0,0.3);
                    margin-top: 30px;">
            <h2 style="font-size: 22px; font-weight: 800; color: var(--text-primary);
                       margin-bottom: 28px; display: flex; align-items: center; gap: 12px;">
                <span style="font-size: 26px;">üì¨</span>
                –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –≤—ñ–¥ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
                <span style="font-size: 14px; font-weight: 700; background: #ffcc00;
                             color: #1a1a1a; padding: 3px 10px; border-radius: 20px; margin-left: 4px;">
                    {{ contact_messages|length }}
                </span>
            </h2>

            <div class="messages-inbox" style="display: flex; flex-direction: column;">
                {% for msg in contact_messages %}
                <div class="inbox-item"
                    style="display: flex; gap: 16px; padding: 18px 8px; border-bottom: 1px solid var(--border-color);">
                    <!-- Avatar -->
                    <div style="flex-shrink: 0; width: 44px; height: 44px; border-radius: 50%;
                                background: linear-gradient(135deg, var(--brand-secondary), var(--brand-primary));
                                display: flex; align-items: center; justify-content: center;
                                font-size: 18px; font-weight: 800; color: white;">
                        {% if msg.sender %}{{ msg.sender.username|first|upper }}{% else %}–ì{% endif %}
                    </div>
                    <!-- Content -->
                    <div style="flex: 1; min-width: 0;">
                        <div
                            style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; margin-bottom: 4px;">
                            <!-- Display name: registered username or –ì—ñ—Å—Ç—å -->
                            <span style="font-weight: 700; font-size: 15px; color: var(--text-primary);">
                                {% if msg.sender %}{{ msg.sender.username }}{% else %}–ì—ñ—Å—Ç—å ({{ msg.name }}){% endif %}
                            </span>
                            <span style="font-size: 13px; color: var(--text-muted);">{{ msg.email }}</span>
                            {% if not msg.is_read %}
                            <span
                                style="font-size: 11px; font-weight: 700; background: #ffcc00; color: #1a1a1a; padding: 2px 8px; border-radius: 10px;">–ù–æ–≤–µ</span>
                            {% endif %}
                        </div>
                        {% if msg.subject %}
                        <p style="font-size: 14px; font-weight: 600; color: var(--text-secondary); margin-bottom: 6px;">
                            {{ msg.subject }}</p>
                        {% endif %}
                        <p
                            style="font-size: 14px; color: var(--text-secondary); line-height: 1.6; white-space: pre-wrap; word-break: break-word;">
                            {{ msg.message }}</p>
                        <span style="font-size: 12px; color: var(--text-muted); margin-top: 8px; display: block;">
                            {{ msg.created_at|date:"d.m.Y H:i" }}
                        </span>
                    </div>
                </div>
                {% empty %}
                <div style="text-align: center; padding: 40px 0; color: var(--text-muted);">
                    <div style="font-size: 48px; margin-bottom: 16px; opacity: 0.4;">üì≠</div>
                    <p style="font-size: 16px;">–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —â–µ –Ω–µ–º–∞—î</p>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endif %}

    </div>
</div>

<style>
    @media (max-width: 900px) {
        .profile-grid {
            grid-template-columns: 1fr !important;
        }

        .profile-sidebar {
            order: -1;
        }

        .profile-sidebar .card {
            position: static !important;
        }
    }

    .action-btn:hover {
        background: var(--bg-primary) !important;
        border-color: var(--brand-primary) !important;
        color: var(--brand-primary) !important;
    }

    .logout-btn:hover {
        background: #fecaca !important;
    }
</style>
{% endblock %}